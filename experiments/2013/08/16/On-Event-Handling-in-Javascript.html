<!DOCTYPE html>
<html>
<head>
  
    <title>On Event Handling in Javascript - </title>
  
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="shortcut icon" href="http://apra.github.io/favicon.ico" />
  <link href='http://fonts.googleapis.com/css?family=Cabin:700|Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
  <link href="http://apra.github.io/css/style.css" type="text/css" rel="stylesheet" />
  <link href="http://apra.github.io/css/syntax.css" type="text/css" rel="stylesheet" />
  <script src="http://code.jquery.com/jquery-latest.js"></script>
  <script type="text/javascript" src="http://apra.github.io/js/site.js"></script>
</head>

<body>

    <div id="top-bar">
            <ul>
                <li id="tweet-icon"><a href="http://twitter.com/codefeeling" target="_blank"><img width="41" height="41" src="http://apra.github.io/images/twitter-bird.png"/></a></li>
            </ul>
            <ul>   
                <li id="fork" class="hub">FOLLOW ME ON</li><a target="_blank" href="http://github.com/Apra" id="github" class="hub">GITHUB</a>
            </ul>
        </div>
<header>
        
   <div id="festoonleft"></div> 
   <a id="tit" href="http://apra.github.io">
    
	  <div id="title"> 
	     <img src="http://apra.github.io/images/arrow.png" width="18" height="24" /> 
	     <img src="http://apra.github.io/images/title.png" width="121" height="67" /> 
	  </div>
	  
      </a><div id="festoonright"></div>
</header>
<script type="text/javascript" >

$(function(){
$("#tweet").html('Probably loading last tweet...');
$.getJSON("http://twitter.com/statuses/user_timeline/codefeeling.json?callback=?", function(data) {
pattern=/(http|https|ftp|ftps)\:\/\/[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,3}(\/\S*)?/;
			patthash=/(#)(\w+)/;
			patttagg=/(\@)(\S+)/;
			tagg=patttagg.exec(data[0].text);
			linc=pattern.exec(data[0].text);
			hash=patthash.exec(data[0].text);
			text=data[0].text;
			(linc) ? text=text.replace(linc[0],'<a target="_blank" href="'+linc[0]+'">'+linc[0]+'</a>'):text;
			(hash) ? text=text.replace(hash[0],'<a target="_blank" href="https://twitter.com/#!/search?q='+hash[2]+'">'+hash[0]+'</a>'):text;  
     		(tagg) ? text=text.replace(tagg[0],'<a target="_blank" href="https://twitter.com/'+tagg[2]+'">'+tagg[0]+'</a>'):text;
     $("#tweet").html('<a target="_blank" href="http://twitter.com/codefeeling" style="float:left;margin: 0 4px;color:#f44f59">@codefeeling</a>'+text);
});
});
</script>
    
    
      <div class="clearer"></div>
<section id="post">
<section id="top-part">
	<h1 class="art-title">On Event Handling in Javascript<span class="dot">.</span></h1>
	<div id="date">Publishing date: 16 08 2013</div>  
	<div class="art-image">
		<img src="http://apra.github.io/uploads/javascript-book.jpg" />   
	</div>
	<div class="content">
		<h2><a href="http://apra.github.io/categories/experiments">experiments</a></h2>
		<div class="iconclass"><img src="http://apra.github.io/images/experiments-logo.png" /></div>
		<div class="tags">
			
     				<li class="tag"><a href="http://apra.github.io/tag/event">event</a></li>
    		
     				<li class="tag"><a href="http://apra.github.io/tag/javascript">javascript</a></li>
    		
     				<li class="tag"><a href="http://apra.github.io/tag/node.js">node.js</a></li>
    		
     				<li class="tag"><a href="http://apra.github.io/tag/pattern">pattern</a></li>
    					
		</div>
	</div>
</section>
	<div id="thepost">
   	<h2>Introduction</h2>

<blockquote><p>Skip it. The code is in the end.</p></blockquote>

<p>One of the most amazing things about Javascript is its semplicity. You can write code very easily, just copy and paste a short snippet of code to create animations, enable interaction between the user and the page or talk to the server. Developers brought this code to the next level, achieving classes, namespaces and inheritance, with the help of the improvements made to the language itself and studying all the possible way to achieve a certain result using different patterns (I suggest reading the book written by <em>Addy Osmani</em> "<a href="http://addyosmani.com/resources/essentialjsdesignpatterns/book/">Essential Javascript Deisgn Patterns</a>"). But I'm here today to talk about event handling.</p>

<h2>The concept</h2>

<p>With Event Handling we want to be able to know when something happen and do something when that thing happen. To make this simple and start using the words used in the code let's make an example. I ask my girlfriend to kiss me everytime a firework is <code>fired</code>, so she will <code>handle</code> me a kiss (let's assume handle means give) every time they <code>emit</code> a firework.</p>

<h2>The pseudo-code</h2>

<pre><code>function addhandler(name of the event, things to do){
    add to the things to handle(do) when the event happens
}
function fire(name of the event, additional information){
    if I should do something during this event, do it 
    and give it some additional information if I have some
}
function removehandler(name of the event, the thing i do){
    when event happens don't do that thing anymore
}
</code></pre>

<h2>The Node way</h2>

<p>Node has a EventEmitter module, this means that it provides a specific module to handle events. <a href="https://github.com/joyent/node/blob/master/lib/events.js">Here</a> the link to the original code.</p>

<h3>Analysis</h3>

<p>The Node code is interesting because accepts every possibility: multiple things to do with multiple arguments per thing. Another thing to observe when analyzing a pattern is the way it's implemented: you need to define a specific object with the point of remembering and firing events. This is used when a big app needs to know when some particular thing happens without having to redefine the event handler for each module used in the app.</p>

<h4>Pros</h4>

<ul>
<li>One object needed</li>
<li>Global awearness</li>
</ul>


<h4>Cons</h4>

<ul>
<li>Few unique events available</li>
</ul>


<h2>The prototype way</h2>

<p>I've read about the prototype pattern <a href="http://motionharvest.com/2013/02/01/custom-events/">here</a>. This is similar to the node way, but here you define the event dispatcher for each object, in his prototype. It's similar to jQuery, where you associate the event to the object <code>$('div').on('...',fun)</code>.</p>

<h3>Analysis</h3>

<p>This pattern let you define event for each object you create, it's useful if you are creating a game or having to check when something happen only to a specific object, rather than to all objects like it. I think this approach is very useful also when used with the Creational Pattern (described in the book <a href="http://addyosmani.com/resources/essentialjsdesignpatterns/book/">Essential Javascript Design Pattern</a>)</p>

<h4>Pros</h4>

<ul>
<li>Local awearness</li>
<li>Object-specific</li>
</ul>


<h4>Cons</h4>

<ul>
<li>Multiple definitions</li>
</ul>


<h2>The way I did it</h2>

<p>Here is the code I created for my application. I started asking myself "<em>Will I ever need multiple functions happening at the same event?</em>" and then "<em>Will I need to remove only one of these functions?</em>". I then removed all the useless parts in the Node code and sticked the event handler to the input module of my app, since it will manage all inputs and then send them to the core.</p>

<p>The code:</p>

<div class="highlight"><pre><code class="javascript">   <span class="kd">var</span> <span class="nx">input</span><span class="o">=</span><span class="p">{}</span>
    <span class="c1">//this trick creates a namespace for the input object</span>
    <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">){</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">emit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">l</span><span class="p">,</span><span class="nx">args</span><span class="p">,</span><span class="nx">handler</span><span class="p">,</span><span class="nx">listener</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">)</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_events</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="nx">handler</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">[</span><span class="nx">type</span><span class="p">];</span>
    
        <span class="c1">//if there is no such event </span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">handler</span> <span class="o">==</span> <span class="kc">undefined</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        
        <span class="c1">//If I have some argument to pass, arguments is used as the global var, google it</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">){</span>
            <span class="nx">l</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
            <span class="nx">args</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
                <span class="nx">args</span><span class="p">[</span><span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
            
            <span class="c1">//Apply the args to the function</span>
            <span class="nx">listener</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">addListener</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//Must be a function, otherwise I won&#39;t know what to do</span>
        <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">listener</span> <span class="o">!==</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">)</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_events</span> <span class="o">=</span> <span class="p">{};</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">[</span><span class="nx">type</span><span class="p">])</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">[</span><span class="nx">type</span><span class="p">]</span> <span class="o">=</span> <span class="nx">listener</span><span class="p">;</span>
        <span class="k">else</span> <span class="c1">//I already have a function for this event</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>         
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">removeListener</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="o">||!</span><span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">[</span><span class="nx">type</span><span class="p">])</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">;</span> <span class="c1">//nothing to remove here</span>
        
        <span class="c1">//remove the listener, there will be the type, but it won&#39;t fire</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">[</span><span class="nx">type</span><span class="p">])</span>
            <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">[</span><span class="nx">type</span><span class="p">];</span>
        <span class="k">else</span> <span class="c1">//there is no such event</span>
            <span class="k">return</span> <span class="kc">false</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="c1">//Just to make it easier to use</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">on</span><span class="o">=</span><span class="nx">c</span><span class="p">.</span><span class="nx">addListener</span><span class="p">;</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">off</span><span class="o">=</span><span class="nx">c</span><span class="p">.</span><span class="nx">removeListener</span>
    <span class="p">})(</span><span class="nx">input</span><span class="p">)</span>
</code></pre>
</div>


<h2>Conclusion</h2>

<p>So, this is a little analysis about the current state of event handling. I summed the two used patterns of it, adding the simplified but limited one. I'm ready to update and change this post. If this doesn't cover the known patterns well enough, I'll add the code and comment it, you just need to ask. See you later!</p>

   	<script type="text/javascript" src="https://apis.google.com/js/plusone.js">
  {lang: "it"}
</script>	
<div id="social-bar">
	<h3>YOU <span style="color:#a3d3f9">LIKED</span> ? <span style="color:#f4343f;margin: 0 0 0 5px;"> SHARE</span>.</h3>
	<li><div id="fb-root"></div><script src="http://connect.facebook.net/en_US/all.js#appId=108089942626497&amp;xfbml=1"></script><fb:like href="" send="true" layout="button_count" width="150" show_faces="false" action="like" font="lucida grande"></fb:like></li>
	<li><a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="tutorialdocks">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script></li>
	<li><g:plusone size="medium"></g:plusone></li>
</div>
   	<div id="bio">
			<div id="photo"><img src="http://apra.github.io/images/account_icon.png" /></div>
			<p id="intro"><em>Web Developer & WP7 Developer, appassionato di Javascript, PHP e C#.</em></p>
   	</div>
   	 <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'codefeeling'; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        
	</div>
	<div id="sidebar">
	<ul id="sidetwitter">
	<h3 style="font-family:Bebas">Find me on</h3>
	<br />
	<iframe src="http://ghbtns.com/github-btn.html?user=apra&type=follow"
  allowtransparency="true" frameborder="0" scrolling="0" width="132" height="20"></iframe>
		<a href="https://twitter.com/codefeeling" class="twitter-follow-button" data-show-count="false" data-lang="it">Segui @codefeeling</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>	
<!-- Inserisci questo tag nel punto in cui vuoi che sia visualizzato l'elemento badge. -->
<li id="googleplusli"><div class="g-plus" data-width="182" data-height="69" data-href="//plus.google.com/109692874390234527065?rel=author"></div></li>

<!-- Inserisci questo tag dopo l'ultimo tag di badge. -->
<script type="text/javascript">
  window.___gcfg = {lang: 'it'};

  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>	

	</ul>
	<ul id="sideposts">
	<h3 style="font-family:Bebas">Other entries</h3>
	<br />
	
	
		<li><a href="/experiments/2013/08/16/On-Event-Handling-in-Javascript.html">On Event Handling in Javascript </a> <p>16 08 2013</p></li>
	
	
	
		<li><a href="/projects/2013/06/09/The-LEAP-Project-Diaries%3A-some-first-thoughts.html">The LEAP Project Diaries-some first thoughts </a> <p>16 08 2013</p></li>
	
	
	
		<li><a href="/thoughts/2013/02/16/gesture-article.html">Why using gesture-based technology? </a> <p>16 08 2013</p></li>
	
	
	</ul>
</div>

  </section>
 
 <!-- <div class="next-prev-nav low-top">
    
      &laquo;&nbsp;<a href="/projects/2013/06/09/The-LEAP-Project-Diaries%3A-some-first-thoughts.html" rel="previous" title="The LEAP Project Diaries-some first thoughts">The LEAP Project Diaries-some first thoughts</a>
    
  
    
      
    
    </div> -->
<script>
$(document).ready(function(){
	if($(window).width()<900&&$(window).width()>850){

		$('body').find('section#post #top-part .content h2').each(function(){
			$(this).css('font-size',((2.5/900)*$(window).width())+'em')
		});
	}else{
		$('body').find('section#post #top-part .content h2').each(function(){
			$(this).css('font-size',('2.5em'))
		});
	}
	$('body').find('section#post #top-part .content h2').each(function(){
		$(this).data('size-font',$(this).css('font-size'));
	});
});
$(window).resize(function(){
	if($(window).width()<900&&$(window).width()>850){$('body').find('section#post #top-part .content h2').each(function(){
			$(this).css('font-size',((2.5/900)*$(window).width())+'em')
		});
		}else{
		$('body').find('section#post #top-part .content h2').each(function(){
			$(this).css('font-size',('2.5em'))
		});
		}
});
$('#bio').live('click',function(){
	window.location='https://plus.google.com/109692874390234527065'
})
</script>


    

      

    
    <div class="clearer"></div>
<footer>
<section>
<div id="copyright">
	<p>CC Attribution-Share Alike 3.0</p>
	<div id="footer-title"> 
		<a href="http://apra.github.io"><img src="http://apra.github.io/images/title-all.png" /></a> 
	</div> 
</div>
</section>
</footer>
    
</body>
</html>
